
- hosts: all
  become: true

  tasks:
    - name: Disable SELinux
      ansible.posix.selinux:
        state: disabled

    - name: Set ip forwarding on in /proc and in the sysctl file and reload if necessary
      ansible.posix.sysctl:
        name: net.ipv4.ip_forward
        value: '1'
        sysctl_set: true
        state: present
        reload: true

    - name: Enable EPEL Repo
      ansible.builtin.dnf:
        name: epel-release
        state: latest

    - name: Add the Kubernetes yum repository
      ansible.builtin.copy:
        dest: /etc/yum.repos.d/kubernetes.repo
        content: |
          [kubernetes]
          name=Kubernetes
          baseurl=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/
          enabled=1
          gpgcheck=1
          gpgkey=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/repodata/repomd.xml.key

    - name: Install necessary packages for Enterprise Linux
      ansible.builtin.dnf:
        name:
          - jq
          - python-setuptools
          - python3-pip
          - kubectl
          - python3-kubernetes
        update_cache: true
        state: present

